<div class="container">

	<h1>Time registrering</h1>

	<div class="row">
		<div class="col-lg-3">
			<div class="timer">
				<% @v_last_year_1 = Voucher.last_year_first_6_months(Time.now - 1.year).sum(:number) %>
				<% @v_last_year_2 = Voucher.last_year_last_6_months(Time.now - 1.year).sum(:number) %>
				<% @v_this_year_1 = Voucher.this_year_first_6_months(Time.now.to_date).sum(:number) %>
				<% @v_this_year_2 = Voucher.this_year_last_6_months(Time.now.to_date).sum(:number) %>
				<b>Købte timer ialt: <%= delimiter(Voucher.sum(:number)) %></b><br>
				<b>2 år tilbage ialt: <%= delimiter(@v_last_year_1 + @v_last_year_2 + @v_this_year_1 + @v_this_year_2) %></b><br><br>
				1. halvår <%= (Time.now - 1.year).year %> - <%= delimiter(@v_last_year_1) %><br>
				2. halvår <%= (Time.now - 1.year).year %> - <%= delimiter(@v_last_year_2) %><br>
				1. halvår <%= (Time.now).year %> - <%= delimiter(@v_this_year_1) %><br>
				2. halvår <%= (Time.now).year %> - <%= delimiter(@v_this_year_2) %><br>
			</div>
		</div>
		<div class="col-lg-3">
			<% @h_last_year_1 = Hour.last_year_first_6_months(Time.now - 1.year).sum(:number) %>
			<% @h_last_year_2 = Hour.last_year_last_6_months(Time.now - 1.year).sum(:number) %>
			<% @h_this_year_1 = Hour.this_year_first_6_months(Time.now.to_date).sum(:number) %>
			<% @h_this_year_2 = Hour.this_year_last_6_months(Time.now.to_date).sum(:number) %>
			<div class="timer">
				<b>Brugte timer ialt: <%= delimiter(Hour.sum(:number)) %></b><br>
				<b>2 år tilbage ialt: <%= delimiter(@h_last_year_1 + @h_last_year_2 + @h_this_year_1 + @h_this_year_2) %></b><br><br>
				1. halvår <%= (Time.now - 1.year).year %> - <%= delimiter(@h_last_year_1)%><br>
				2. halvår <%= (Time.now - 1.year).year %> - <%= delimiter(@h_last_year_2) %><br>
				1. halvår <%= (Time.now).year %> - <%= delimiter(@h_this_year_1) %><br>
				2. halvår <%= (Time.now).year %> - <%= delimiter(@h_this_year_2) %><br>
			</div>
		</div>
	</div>
	<br>
	<div class="btn-group">
		<%= link_to 'Ny registrering', new_hour_path, class: 'btn btn-default btn-xs' %>
		<%= link_to 'Find alle', all_partner_hours_path, class: 'btn btn-default btn-xs' %>
	</div>
	<div class="table-responsive">
		<table class="table table-striped table-hover">
			<tr>
				<th colspan="4" class='text-left' >Kunde</th>
				<th colspan="4" class='text-center' >Købt/Brugt</th>
				<th colspan="4" class='text-right' >Status</th>
			</tr>
			<% for partner in @partners %>
			<% @partner = Partner.find(partner.id)%>
			<% if @partner.hours.size > 0 %>
				<tr>
					<td colspan="4">
						<div id="voucher_customer">
							<%= link_to Partner.find(partner.id).name, show_years_path(partner_id: partner.id, q: params[:q]), class: 'name'%>
						</div>
					</td>
					<td colspan="4" class="text-center">
						<div id="voucher_calc">
							<span id="voucher_text">
								(<%= delimiter(@partner.vouchers.sum(:number)) rescue nil %> 
								- <%= delimiter(@partner.hours.sum(:number)) rescue nil %>)
							</span>
						</div>
					</td>
					<td colspan="4" class="text-right">
						<div id="voucher_status">
							<span id="voucher_text">
								<% @result = @partner.vouchers.sum(:number) - @partner.hours.sum(:number) rescue nil %>
								<% if @result < 0 %>
								<span id='voucher_red'> <%= delimiter(@result) %></span> 
								<% else %>
								<span id='voucher_green'> <%= delimiter(@result) %></span> 
								<% end %>
							</span>
						</div>
					</td>
				</tr>
			<% end %>
				<% if partner.id.to_s == params[:partner_id] %>
					<% for year in @years %>
						<%= render partial: "partners/partials/years_specified", locals: {partner: partner, year: year} %>
					<% end %>
				<% end %>
			<% end %>
		</table>
	</div>
</div>